<%- include('../../partials/header') %>
<section class="content-block white">
      <h1>
        <script>
          (function(){
            var isMyPath = window.location.pathname.indexOf('/datasets/my') === 0;
            var loggedIn = <%- JSON.stringify(!!user) %>;
            document.currentScript.parentElement.textContent = (loggedIn || isMyPath) ? 'My Datasets' : 'Datasets';
          })();
        </script>
      </h1>
  <table id="responsesTable" class="display" style="width:100%">
    <thead>
      <tr>
        <th>Dataset</th>
        <th># of Certificates</th>
        <th>Top Level</th>
        <th>Updated</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <p>
    <a class="button" href="/datasets/new">+ Add new dataset</a>
  </p>
</section>

<link rel="stylesheet" href="/lib/DataTables/datatables.css" />
<script src="/lib/DataTables/datatables.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const table = new DataTable('#responsesTable', {
      ajax: (function(){
        var loggedIn = <%- JSON.stringify(!!user) %>;
        var isMyPath = window.location.pathname.indexOf('/datasets/my') === 0;
        var url = (loggedIn || isMyPath) ? '/datasets/my' : '/datasets';
        return { url: url, headers: { 'Accept': 'application/json' } };
      })(),
      processing: true,
      serverSide: false,
      searching: true,
      ordering: true,
      responsive: true,
      columns: [
        { data: 'dataTitle', render: (d, t, row) => {
            const url = row.webpage || '#';
            const text = d || '(untitled)';
            return url ? `<a href="${url}" target="_blank" rel="noopener">${text}</a>` : text;
          }
        },
        { data: 'myCount' },
        { data: 'levelLabel' },
        { data: 'updatedAt', render: (d) => d ? new Date(d).toLocaleString() : '' },
        { data: 'actions', render: (d) => `<a href="${d}">View certificates</a>` }
      ]
    });
  });
</script>
<%- include('../../partials/footer') %>


