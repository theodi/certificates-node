<!-- views/partials/header.ejs -->
<!DOCTYPE html>
<html prefix="dct: http://purl.org/dc/terms/
              rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns#
              dcat: http://www.w3.org/ns/dcat#
              odrs: http://schema.theodi.org/odrs#">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title><%= page.title %></title>
<script src="/lib/jquery-3.7.1.min.js"></script>

<link href="/css/water.css" rel="stylesheet">
<link href="/css/odi.css" rel="stylesheet">
<link href="/css/survey.css" rel="stylesheet">
<link rel="shortcut icon" href="/images/odifavicon32.ico">
</head>
<body>
	<div id="contentOverlay" class="overlay">
		<div id="overlay-content" class="overlay-content" style="width: 90%; margin: auto; margin-top: 20px; max-height: 90vh;">
			<span class="close-btn" onclick="closeOverlay()" style="right: 40px;
			top: 20px;
			font-size: 3rem;
			font-weight: normal;">&times;</span>
			<div id="overlay-content-inner" style="overflow-y: scroll; min-width: 100%;"></div>
		</div>
	</div>
	
	<!-- Mobile menu overlay -->
	<div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>
	
	<header class="header">
		<p class="version"><a href="<%= software.versionLink %>" target="_blank">v<%= software.version %></a></p>
		<div class="container">
			<div class="header-top">
				<h1><a href="/">ODI Certificates</a></h1>
				
				<!-- Hamburger menu button -->
				<button class="hamburger" id="hamburger" aria-label="Toggle navigation menu">
					<span></span>
					<span></span>
					<span></span>
				</button>
				
				<nav class="main-nav" id="mainNav" aria-label="Main Menu">
					<ul>
						<li><a href="/datasets/new" class="toggle-link <% if (page.link === '/datasets/new') { %>selected<% } %>">Create new certificate</a></li>
						<% if(user) { %>
							<li><a href="/datasets/my" class="toggle-link <% if (page.link === '/datasets/my') { %>selected<% } %>">Your certificates</a></li>
							<li><a href="/about" class="toggle-link <% if (page.link === '/about') { %>selected<% } %>">About</a></li>
							<li><a href="/about/faq" class="toggle-link <% if (page.link === '/about/faq') { %>selected<% } %>">FAQ</a></li>
							<li>
								<a style="padding: 0;" class="toggle-link <% if (page.link === '/auth/profile') { %>selected<% } %>" href="/auth/profile"><%= user ? (user.displayName || (user.first_name && user.last_name ? user.first_name + ' ' + user.last_name : user.email)) : 'Guest' %></a>
								<form style="display: inline-flex;" id="logout_form" action="/auth/logout" method="post">
									 &nbsp;<a href="javascript:;" onclick="document.getElementById('logout_form').submit();">(Logout)</a>
								</form>
							</li>
						<% } else { %>
							<li><a href="/datasets" class="toggle-link <% if (page.link === '/datasets') { %>selected<% } %>">Browse certificates</a></li>
							<li><a href="/about" class="toggle-link <% if (page.link === '/about') { %>selected<% } %>">About</a></li>
							<li><a href="/about/faq" class="toggle-link <% if (page.link === '/about/faq') { %>selected<% } %>">FAQ</a></li>
							<li><a href="/auth/django" class="toggle-link">Login</a></li>
						<% } %>
					</ul>
				</nav>
			</div>
		</div>
	</header>
	
	<script>
		// Mobile menu functionality
		document.addEventListener('DOMContentLoaded', function() {
			const hamburger = document.getElementById('hamburger');
			const mainNav = document.getElementById('mainNav');
			const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
			
			function toggleMenu() {
				hamburger.classList.toggle('active');
				mainNav.classList.toggle('active');
				mobileMenuOverlay.classList.toggle('active');
				document.body.style.overflow = mainNav.classList.contains('active') ? 'hidden' : '';
			}
			
			function closeMenu() {
				hamburger.classList.remove('active');
				mainNav.classList.remove('active');
				mobileMenuOverlay.classList.remove('active');
				document.body.style.overflow = '';
			}
			
			// Toggle menu on hamburger click
			hamburger.addEventListener('click', toggleMenu);
			
			// Close menu when clicking overlay
			mobileMenuOverlay.addEventListener('click', closeMenu);
			
			// Close menu when clicking a menu item
			mainNav.addEventListener('click', function(e) {
				if (e.target.tagName === 'A') {
					closeMenu();
				}
			});
			
			// Close menu on escape key
			document.addEventListener('keydown', function(e) {
				if (e.key === 'Escape' && mainNav.classList.contains('active')) {
					closeMenu();
				}
			});
			
			// Close menu on window resize (if screen becomes larger)
			window.addEventListener('resize', function() {
				if (window.innerWidth > 768 && mainNav.classList.contains('active')) {
					closeMenu();
				}
			});
		});
	</script>